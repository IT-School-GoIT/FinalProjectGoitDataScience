<h2>Логін</h2>
<video id="video" width="720" height="560" autoplay muted></video>
<div id="result"></div>

<style>
  #success-animation {
    display: none;
    width: 100px;
    height: 100px;
    background-color: green;
    border-radius: 50%;
    animation: pulse 1s infinite;
    margin: 20px auto;
  }

  @keyframes pulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.2);
    }
    100% {
      transform: scale(1);
    }
  }
</style>

<div id="success-animation"></div>

<script>
    const video = document.getElementById('video');
    const successAnimation = document.getElementById('success-animation');
    const resultText = document.getElementById('result');

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            video.srcObject = stream;
        })
        .catch(err => {
            console.error("Помилка доступу до камери: ", err);
        });

    // Відправляємо кадр з камери на сервер для розпізнавання обличчя
    function sendFrameToServer() {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

        canvas.toBlob(function(blob) {
            const formData = new FormData();
            formData.append('image', blob);

            fetch('/face_id/face_login/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    successAnimation.style.display = 'block';
                    resultText.innerText = 'Обличчя знайдено! Перенаправлення...';
                    setTimeout(() => {
                        window.location.href = data.redirect_url;
                    }, 1000);  // Затримка перед редіректом для показу анімації
                } else {
                    successAnimation.style.display = 'none';
                    resultText.innerText = 'Обличчя не знайдено';
                }
            })
            .catch(error => {
                console.error('Помилка: ', error);
            });
        });
    }

    setInterval(sendFrameToServer, 1000);  // Відправляємо кадр кожну секунду
</script>
